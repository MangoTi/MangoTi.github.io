---
layout:     post   				    # 使用的布局（不需要改）
title:      http2.0优势 				# 标题 
subtitle:   深入理解生命周期各个过程发生的事 #副标题
date:       2018-12-11 				# 时间
author:     XMT 						# 作者
header-img: img/post-bg-2015.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - http
---

2015年，http2.0到来，比起1.0快非常多，性能提升主要是在以下几个方面：
## 1、二进制分帧层
http/1.1响应是文本格式，而2.0将一个http请求的头部和数据划分成两个帧，并采取二进制来编码。
这里我们来提三个概念。  

* 流（Stream）：已建立的TCP连接上的双向字节流，可以承载一个或多个消息。
* 消息（Message）：一个完整的HTTP请求或响应，由一个或多个帧组成。特定消息的帧在同一个流上发送，这意味着一个HTTP请求或响应只能在一个流上发送。
帧（Frame）：通信的基本单位。
* 一个TCP连接上可以有任意数量的流。
## 2、多路复用
http1.0存在线头阻塞问题，即一个TCP连接只能发送一个请求，前面的请求未完成，后面都要排队，虽然允许多个TCP连接也可以支持请求并发，但是因为TCP连接成本很高，所以各个浏览器都不支持。 

而2.0让所以的请求都在一个TCP连接上进行，每个连接可以并发有多个流，消息分割成一个或多个帧在流中传输，帧传过去之后再重组，形成一个完整的请求或响应，但是由于客户端和服务器能同时处理的请求或响应都是有限的，当请求过多时还是需要排队的。  

## 3、头部压缩
每个http请求的头部的字段都是相同的，如cookie、user-agent等，因此2.0采用HPACK压缩格式来压缩头部，在客户端和服务器之间要维护：  
* 维护一份相同的静态字典，包含常见的头部名称，以及常见的头部名称和值的组合，如：scheme有两种http及https，索引分别是6和7，直接存储6或7就可以了，method:GET/POST是2/3同理； 

* 维护一份相同的动态字典，可以动态的添加内容，头部中比如cookie只有一个名称，值不固定，第一次传输时会需要它在静态字典中的索引以及其值，该值会采用Huffman编码来减少体积，第一次传输之后就会加入其动态字典中，下次就是一个索引就搞定了。

## 4、服务器端推送
服务器端推送使得服务器可以预测客户端需要的资源，主动推送到客户端。

例如：客户端请求index.html，服务器端能够额外推送script.js和style.css。 实现原理就是客户端发出页面请求时，服务器端能够分析这个页面所依赖的其他资源，主动推送到客户端的缓存，当客户端收到原始网页的请求时，它需要的资源已经位于缓存。  

针对每一个希望发送的资源，服务器会发送一个PUSH_PROMISE帧，客户端可以通过发送RST_STREAM帧来拒绝推送（当资源已经位于缓存）。这一步的操作先于父响应（index.html），客户端了解到服务器端打算推送哪些资源，就不会再为这些资源创建重复请求。当客户端收到index.html的响应时，script.js和style.css已经位于缓存。


作者：黑金团队
链接：https://juejin.im/post/5c0ce870f265da61171c8c66
来源：掘金
